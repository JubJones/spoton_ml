mlflow:
  experiment_name: "MTMMC Detection Training (RT-DETR)"

environment:
  device: "auto" # Options: "auto", "cuda:0", "mps", "cpu"
  seed: 42

data:
  # base_path: "/Volumes/HDD/MTMMC"
  base_path: "D:/MTMMC" # Adjust to your dataset location
  # Define scenes and cameras to USE for this entire comparison run
  # FULL DATASET CONFIGURATION - All available scenes and cameras
  scenes_to_include:
    # Factory scenes
    - scene_id: "s01"
      camera_ids: ["c01", "c02", "c03", "c04", "c05", "c06", "c07", "c08", "c09", "c10", "c11", "c12", "c13", "c14", "c15", "c16"]
    - scene_id: "s10" # Factory
      camera_ids: ["c01", "c02", "c03", "c04", "c05", "c06", "c07", "c08", "c09", "c10", "c11", "c12", "c13", "c14", "c15", "c16"]
    
    # Campus scenes  
    - scene_id: "s14"
      camera_ids: ["c01", "c02", "c03", "c04", "c05", "c06", "c07", "c08", "c09", "c10", "c11", "c12", "c13", "c14", "c15", "c16"]
    - scene_id: "s47" # Campus
      camera_ids: ["c01", "c02", "c03", "c04", "c05", "c06", "c07", "c08", "c09", "c10", "c11", "c12", "c13", "c14", "c15", "c16"]

  # Data subsetting for production training - DISABLED for full dataset
  use_data_subset: false # CHANGED: Set to false to use ALL data
  data_subset_fraction: 0.1  # Full dataset when use_data_subset is false

  # Train/Val split
  val_split_ratio: 0.2 # Proportion of (sub)set to use for validation
  num_workers: 2 # Number of workers for DataLoader

# --- Models to Train (Child Runs) ---
models_to_train:
  # --- RT-DETR Configuration ---
  - model:
      type: "rtdetr"
      name_tag: "RTDETR_Ultralytics" # Used for run naming if run_name isn't specified below
      model_size: "rtdetr-l.pt" # Options: rtdetr-l.pt, rtdetr-x.pt, or custom path
      num_classes: 1 # Only person class (Ultralytics format - no background)
      
    training:
      engine: "ultralytics"
      epochs: 1  # PRODUCTION: Increased from 2 to 100 for serious training
      batch_size: 8  # PRODUCTION: Increased from 4 to 8 for better convergence (adjust based on GPU memory)
      learning_rate: 0.001  # Base learning rate (overridden by lr0 in Ultralytics)
      # RT-DETR specific parameters for Ultralytics - PRODUCTION OPTIMIZED
      imgsz: 640 # Image size for training
      patience: 30 # PRODUCTION: Increased from 20 to 30 for full dataset training
      save_period: 5 # PRODUCTION: Save checkpoints more frequently (every 5 epochs)
      cache: true # PRODUCTION: Enable caching for faster training on large dataset
      device: null # Will use the device from environment config
      workers: 8 # PRODUCTION: Increased from 2 to 8 for faster data loading
      project: "checkpoints" # Project directory for saving runs
      name: "rtdetr_run" # Run name for saving checkpoints
      exist_ok: true # Overwrite existing project/name
      pretrained: true # Use pretrained weights
      optimizer: "AdamW" # Optimizer: SGD, Adam, AdamW, NAdam, RAdam, RMSProp
      verbose: true # Verbose output
      seed: 42 # Random seed (will be overridden by environment.seed)
      deterministic: true # Deterministic training for reproducibility
      single_cls: true # Train as single-class dataset (person only)
      rect: false # Rectangular training
      cos_lr: false # Cosine learning rate scheduler
      close_mosaic: 10 # Disable mosaic augmentation for final epochs
      resume: false # Resume training from last checkpoint
      amp: true # Automatic Mixed Precision training
      fraction: 1.0 # Dataset fraction to train/val/test on
      profile: false # Profile ONNX and TensorRT speeds during training for best inference speed
      freeze: null # Freeze layers: backbone=10, first3=0:3, etc
      
      # PRODUCTION LEARNING RATE SCHEDULER
      lr0: 0.001 # PRODUCTION: Good stable learning rate for large dataset
      lrf: 0.01 # Final learning rate (lr0 * lrf) = 0.00001 final LR
      momentum: 0.937 # SGD momentum/Adam beta1
      weight_decay: 0.0005 # Optimizer weight decay 5e-4
      warmup_epochs: 10.0 # PRODUCTION: Increased to 10 for large dataset warmup
      warmup_momentum: 0.8 # Warmup initial momentum
      warmup_bias_lr: 0.1 # Warmup initial bias lr
      
      # Additional stability parameters
      max_grad_norm: 10.0 # Gradient clipping to prevent explosions
      box: 7.5 # Box loss gain
      cls: 0.5 # Cls loss gain (used with pixels and ratio)
      dfl: 1.5 # DFL loss gain
      pose: 12.0 # Pose loss gain (pose-only models)
      kobj: 2.0 # Keypoint obj loss gain (pose-only models)
      # label_smoothing: 0.1 # DEPRECATED in newer Ultralytics versions
      nbs: 64 # Nominal batch size for normalization
      
      # ENHANCED COMPLEX AUGMENTATION SETTINGS
      # =====================================
      
      # Color Space Augmentations (Enhanced HSV)
      hsv_h: 0.03 # Image HSV-Hue augmentation (fraction) - increased for more color variety
      hsv_s: 0.8 # Image HSV-Saturation augmentation (fraction) - enhanced saturation changes
      hsv_v: 0.6 # Image HSV-Value augmentation (fraction) - increased brightness variation
      
      # Geometric Augmentations (Complex Spatial Transforms)
      degrees: 15.0 # Image rotation (+/- deg) - significant rotation for robustness
      translate: 0.2 # Image translation (+/- fraction) - increased translation range
      scale: 0.7 # Image scale (+/- gain) - wider scale variation for multi-scale objects
      shear: 10.0 # Image shear (+/- deg) - add perspective distortion
      perspective: 0.0005 # Image perspective (+/- fraction) - 3D perspective transformation
      
      # Flip Augmentations
      flipud: 0.1 # Image flip up-down (probability) - occasional vertical flips
      fliplr: 0.5 # Image flip left-right (probability) - standard horizontal flips
      
      # Advanced Composition Augmentations
      mosaic: 0.8 # Image mosaic (probability) - slightly reduced for stability
      mixup: 0.15 # Image mixup (probability) - blend images for regularization
      copy_paste: 0.1 # Segment copy-paste (probability) - object duplication for variety
      
      # Advanced Augmentation Parameters (New)
      multi_scale: true # Enable multi-scale training for scale invariance
      erasing: 0.2 # Random erasing probability for occlusion robustness
      auto_augment: "randaugment" # Use RandAugment for automatic policy selection
      
      # Cutout/Occlusion Augmentations
      cutmix: 0.1 # CutMix augmentation probability for partial occlusion
      
      # Advanced Training Strategies
      rect: false # Keep rectangular training disabled for consistent augmentation
      multi_scale: true # Multi-scale training with dynamic image sizing
      
      # Validation settings
      val: true # Validate/test during training
      split: "val" # Dataset split to use for validation (train/val/test)
      save_json: true # Save results to JSON file for analysis
      save_hybrid: false # Save hybrid version of labels (labels + additional information)
      conf: null # Object confidence threshold for detection (default 0.25 predict, 0.001 val)
      iou: 0.7 # Intersection over Union (IoU) threshold for NMS
      max_det: 300 # Maximum number of detections per image
      half: false # Use half precision (FP16)
      dnn: false # Use OpenCV DNN for ONNX inference
      plots: true # Show plots during training
      
      # Additional RT-DETR specific settings
      save_best_metric: "metrics/mAP50-95(B)" # Metric to save best model
      checkpoint_dir: "checkpoints/rtdetr"