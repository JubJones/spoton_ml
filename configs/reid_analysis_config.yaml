# Phase 2 Re-ID Analysis Configuration
# Re-ID model performance analysis using ground truth detection boxes

# --- MLflow Configuration ---
mlflow:
  experiment_name: "Phase 2 Re-ID Analysis"

# --- Environment Configuration ---
environment:
  device: "cuda:0"  # Use GPU for Re-ID feature extraction
  seed: 42

# --- Data Configuration ---
data:
  # Update base_path to point to your MTMMC dataset
  base_path: "D:/MTMMC"
  
  # Include all available scenes for comprehensive analysis
  scenes_to_include:
    - scene_id: "s10"
      camera_ids: ["c09", "c12", "c13", "c16"]
    - scene_id: "s47"
      camera_ids: ["c01", "c02", "c03", "c05"]
  
  # Analysis on full validation set
  use_data_subset: false
  data_subset_fraction: 1.0
  
  # Validation split
  val_split_ratio: 0.2
  num_workers: 2

# --- Re-ID Models Configuration ---
reid_models:
  # CLIP-based models
  - name: "clip_duke"
    weights_path: "weights/clip_duke.pt"
    device: "cuda:0"
    architecture: "clip"
    
  - name: "clip_market1501"
    weights_path: "weights/clip_market1501.pt"
    device: "cuda:0"
    architecture: "clip"
    
  # OSNet variants
  - name: "osnet_ibn_x1_0"
    weights_path: "weights/osnet_ibn_x1_0_msmt17.pt"
    device: "cuda:0"
    architecture: "osnet"
    
  - name: "osnet_ain_x1_0"
    weights_path: "weights/osnet_ain_x1_0_msmt17.pt"
    device: "cuda:0"
    architecture: "osnet"
    
  - name: "osnet_x1_0"
    weights_path: "weights/osnet_x1_0_msmt17.pt"
    device: "cuda:0"
    architecture: "osnet"
    
  # LMBN model
  - name: "lmbn_n_duke"
    weights_path: "weights/lmbn_n_duke.pt"
    device: "cuda:0"
    architecture: "lmbn"
    
  # MobileNetV2 for efficiency comparison
  - name: "mobilenetv2_x1_4_market1501"
    weights_path: "weights/mobilenetv2_x1_4_market1501.pt"
    device: "cuda:0"
    architecture: "mobilenetv2"

# --- Phase 2 Re-ID Analysis Configuration ---
analysis:
  # Output directory
  output_dir: "outputs/phase2_reid_analysis"
  
  # Re-ID analysis thresholds
  similarity_threshold: 0.7      # Threshold for considering persons as similar
  fragmentation_threshold: 0.5   # Threshold for intra-ID fragmentation detection
  confusion_threshold: 0.8       # Threshold for inter-ID confusion detection
  
  # Failure collection strategy
  collect_one_per_person: true
  max_failures_per_scene: 1000
  
  # Feature extraction settings
  feature_batch_size: 32
  feature_normalization: "l2"    # l2, l1, or none
  
  # Similarity computation methods
  similarity_methods:
    - "cosine"
    - "euclidean"
    - "inner_product"
  
  # Visualization settings
  colors:
    ground_truth: [0, 255, 0]     # GREEN for ground truth
    reid_prediction: [0, 0, 255]  # RED for Re-ID predictions
    failure_highlight: [255, 0, 0] # RED for failure highlighting
    
  # Crop settings
  crop_size: [256, 128]  # Height x Width for person crops
  crop_padding: 10       # Padding around bounding boxes
  
  # Analysis parameters
  min_track_length: 3              # Minimum frames for temporal analysis
  max_persons_per_scene: 100       # Limit for computational efficiency
  
  # Reporting settings
  generate_html_reports: true
  generate_visualizations: true
  generate_feature_space_plots: true
  generate_similarity_matrices: true
  
  # Environmental analysis
  analyze_lighting_conditions: true
  analyze_crowd_density: true
  analyze_occlusion_levels: true
  analyze_camera_angles: true
  
  # Performance metrics
  calculate_cmc_curves: true       # Cumulative Matching Characteristics
  calculate_map_scores: true       # Mean Average Precision
  calculate_rank_metrics: true     # Rank-1, Rank-5, Rank-10 accuracy
  
  # Feature space analysis
  perform_dimensionality_reduction: true
  tsne_perplexity: 30
  umap_n_neighbors: 15
  
  # Temporal analysis
  analyze_temporal_consistency: true
  temporal_window_size: 10         # Frames for temporal analysis
  
  # Cross-camera analysis
  analyze_cross_camera_performance: true
  camera_domain_adaptation: true
  
  # Model comparison
  compare_models: true
  statistical_significance_test: true
  
  # Advanced analysis
  analyze_failure_patterns: true
  cluster_similar_failures: true
  generate_improvement_recommendations: true

# --- Logging Configuration ---
logging:
  level: "INFO"
  log_to_file: true
  log_file: "logs/phase2_reid_analysis.log"
  
# --- Resource Management ---
resources:
  max_memory_gb: 16
  max_gpu_memory_gb: 8
  enable_memory_cleanup: true
  
# --- Quality Assurance ---
quality:
  validate_reid_models: true
  check_feature_quality: true
  verify_similarity_computations: true
  
# --- Experimental Settings ---
experimental:
  enable_advanced_metrics: true
  prototype_features: false
  debug_mode: false